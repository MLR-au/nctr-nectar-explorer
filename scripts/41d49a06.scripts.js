"use strict";angular.module("nectarExplorerApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("nectarExplorerApp").controller("MainCtrl",["$scope","$window","$sce",function(a,b,c){function d(){var d=function(){d3.select("svg").select("g").attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")},j=function(){e.attr("d",function(a){var b=a.target.x-a.source.x,c=a.target.y-a.source.y,d=Math.sqrt(b*b+c*c);return"M"+a.source.x+","+a.source.y+"A"+d+","+d+" 0 0,1 "+a.target.x+","+a.target.y}),f.attr("transform",function(a){return"translate("+a.x+","+a.y+")"})};g=d3.behavior.zoom().scale([.5]).translate([h/5,i/6]).scaleExtent([0,8]).on("zoom",d);var k=d3.layout.force().nodes(a.nodes).links(a.links).charge(-2e3).linkDistance(200).linkStrength(1).size([h,i]).on("tick",j),l=d3.select("#explorer").append("svg").attr("width",h).attr("height",i).attr("viewBox","0 0 "+h+" "+i).attr("preserveAspectRatio","xMidYMid meet").call(g).append("g").attr("transform","translate("+h/5+","+i/6+")scale(.5,.5)");e=l.selectAll(".path").data(k.links()),f=l.selectAll(".node").data(k.nodes()),e.enter().append("svg:path").attr("class","link"),f.enter().append("g").attr("id",function(a,b){return"node_"+b}).attr("class","node"),f.filter(function(a){return"NeCTAR"===a.id?!0:void 0}).append("image").attr("xlink:href","images/logo.png").attr("x",-100).attr("y",-100).attr("width",200).attr("height",200),f.filter(function(a){return"NeCTAR"!==a.id?!0:void 0}).append("circle").attr("r",function(a){return a.size}).attr("fill",function(a){return a.color}),f.append("text").attr("dx",12).attr("dy",".35em").text(function(a){return a.id}).style("font",function(a){return"NeCTAR"===a.id?"70px sans-serif":"NeCTAR Funded Projects"===a.id||"Research Cloud"===a.id||"Virtual Laboratories"===a.id?"30px sans-serif":"15px sans-serif"}),f.on("click",function(d){a.$apply(function(){a.iframePanelStyle={position:"fixed","z-index":"300",top:"100px",left:(b.innerWidth-700)/2,width:"720px",height:.8*b.innerHeight},a.iframeStyle={border:"0","border-radius":"8px","background-color":"white",overflow:"hidden"},a.nodeSelected=!0,a.targetUrl=c.trustAsResourceUrl(d.attributes.custom_url),a.iframeWidth=720,a.iframeHeight=.8*b.innerHeight})}),k.start();var m=d3.behavior.zoom(l);console.log(m.scale(),m.translate()),m.scale([.5]),m.translate([h/5,i/6]),console.log(m.scale(),m.translate()),m.event(l)}var e,f,g,h=b.innerWidth,i=b.innerHeight,j=angular.element(b);j.bind("resize",function(){a.$apply(function(){d3.select("#explorer").select("svg").style("width",b.innerWidth).style("height",b.innerHeight)})}),d3.json("data/data.json",function(b,c){a.nodes=[],a.links=[];a.$apply(function(){var b=[];angular.forEach(c.nodes,function(a){b.push(a.id)}),angular.forEach(c.edges,function(c){var d={source:b.indexOf(c.source),target:b.indexOf(c.target),weight:1};a.links.push(d)}),a.nodes=c.nodes,d()})}),a.dismiss=function(){a.nodeSelected=!1}}]);